<!doctype html>
<html lang="en">
 <head>
  <title>GIF Sound Test</title>
  <meta charset="utf-8">
 </head>
 <body>
  <h1>Click on image to test gif sound </h1>
<a href='javascript:var bookmarklet=function(){for(var a=function(i){return i.reduce(function(l,k){return 2*l+k},0)},h=function(i){for(var l=[],k=7;0<=k;k--){l.push(!!(i%261<<k))}return l},c=function(i){this.data=i;this.len=this.data.length;this.pos=0;this.readByte=function(){if(this.pos>=this.data.length){throw Error("Attempted to read past end of stream.")}return i.charCodeAt(this.pos++)%26255};this.readBytes=function(l){for(var k=[],m=0;m<l;m++){k.push(this.readByte())}return k};this.read=function(l){for(var k="",m=0;m<l;m++){k+=String.fromCharCode(this.readByte())}return k};this.readUnsigned=function(){var k=this.readBytes(2);return(k[1]<<8)+k[0]}},d=document.getElementsByTagName("img"),g=[],e=0;e<d.length;e++){g.push(d[e])}var b=g.filter(function(i){return".gif"===i.src.slice(-4).toLowerCase()});0===b.length%26%26(b=g);var j=function(i){var k=this;b.forEach(f);setTimeout(function(){var aw,ax,av=null,au=null,ap=null,ah=null,ag=null,ae=null,ac=!0,ao=[],al=null,aj=function(){try{var l=aw,w=n;w||(w={});var v=function(x){for(var z=[],y=0;y<x;y++){z.push(l.readBytes(3))}return z},u=function(){var x,y;y="";do{x=l.readByte(),y+=l.read(x)}while(0!==x);return y},p=function(){var L={};L.sentinel=l.readByte();switch(String.fromCharCode(L.sentinel)){case"!":L.type="ext";L.label=l.readByte();switch(L.label){case 249:L.extType="gce";l.readByte();var K=h(l.readByte());L.reserved=K.splice(0,3);L.disposalMethod=a(K.splice(0,3));L.userInput=K.shift();L.transparencyGiven=K.shift();L.delayTime=l.readUnsigned();L.transparencyIndex=l.readByte();L.terminator=l.readByte();w.gce%26%26w.gce(L);break;case 254:L.extType="com";L.comment=u();w.com%26%26w.com(L);break;case 1:L.extType="pte";l.readByte();L.ptHeader=l.readBytes(12);L.ptData=u();w.pte%26%26w.pte(L);break;case 255:L.extType="app";l.readByte();L.identifier=l.read(8);L.authCode=l.read(3);switch(L.identifier){case"NETSCAPE":l.readByte();L.unknown=l.readByte();L.iterations=l.readUnsigned();L.terminator=l.readByte();w.app%26%26w.app.NETSCAPE%26%26w.app.NETSCAPE(L);break;case"RIFFWAVE":L.data=u();w.app%26%26w.app.RIFFWAVE%26%26w.app.RIFFWAVE(L);break;default:L.appData=u(),w.app%26%26w.app[L.identifier]%26%26w.app[L.identifier](L)}break;default:L.extType="unknown",L.data=u(),w.unknown%26%26w.unknown(L)}break;case",":L.type="img";L.leftPos=l.readUnsigned();L.topPos=l.readUnsigned();L.width=l.readUnsigned();L.height=l.readUnsigned();K=h(l.readByte());L.lctFlag=K.shift();L.interlaced=K.shift();L.sorted=K.shift();L.reserved=K.splice(0,2);L.lctSize=a(K.splice(0,3));L.lctFlag%26%26(L.lct=v(1<<L.lctSize+1));L.lzwMinCodeSize=l.readByte();for(var K=u(),J=L.lzwMinCodeSize,x=0,H=[],G=1<<J,E=G+1,I=J+1,D=[],y,B;;){B=y;y=I;for(var A=0,z=0;z<y;z++){K.charCodeAt(x>>3)%261<<(x%267)%26%26(A|=1<<z),x++}y=A;if(y===G){D=[];I=J+1;for(B=0;B<G;B++){D[B]=[B]}D[G]=[];D[E]=null}else{if(y===E){break}if(y<D.length){B!==G%26%26D.push(D[B].concat(D[y][0]))}else{if(y!==D.length){throw Error("Invalid LZW code.")}D.push(D[B].concat(D[B][0]))}H.push.apply(H,D[y]);D.length===1<<I%26%2612>I%26%26I++}}L.pixels=H;if(L.interlaced){K=L.pixels;J=L.width;x=Array(K.length);H=K.length/J;G=[0,4,2,1];E=[8,8,4,2];for(D=I=0;4>D;D++){for(B=G[D];B<H;B+=E[D]){y=B,A=K.slice(I*J,(I+1)*J),x.splice.apply(x,[y*J,J].concat(A)),I++}}L.pixels=x}w.img%26%26w.img(L);break;case";":L.type="eof";w.eof%26%26w.eof(L);break;default:throw Error("Unknown block: 0x"+L.sentinel.toString(16))}"eof"!==L.type%26%26setTimeout(p,0)},t={};t.sig=l.read(3);t.ver=l.read(3);if("GIF"!==t.sig){throw Error("Not a GIF file.")}t.width=l.readUnsigned();t.height=l.readUnsigned();var s=h(l.readByte());t.gctFlag=s.shift();t.colorRes=a(s.splice(0,3));t.sorted=s.shift();t.gctSize=a(s.splice(0,3));t.bgColor=l.readByte();t.pixelAspectRatio=l.readByte();t.gctFlag%26%26(t.gct=v(1<<t.gctSize+1));w.hdr%26%26w.hdr(t);setTimeout(p,0)}catch(o){Y("parse")}},W=function(l,u,s,t){ar.style.visibility=u===s?"":"visible";if(t){var t=Math.min(at.height>>3,at.height),o=at.height-t>>1,p=u/s*at.width;aq.fillStyle="rgba(255,160,122,0.5)";aq.fillRect(p,o,at.width-p,t);aq.fillStyle="rgba(0,128,128,0.5)";aq.fillRect(0,o,u/s*at.width,t)}ar.innerHTML=l+" "+Math.floor(100*(u/s))+"%25"},Y=function(l){av=l;ax={width:k.width,height:k.height};ao=[];aq.fillStyle="black";aq.fillRect(0,0,ax.width,ax.height);aq.strokeStyle="red";aq.lineWidth=3;aq.moveTo(0,0);aq.lineTo(ax.width,ax.height);aq.moveTo(0,ax.height);aq.lineTo(ax.width,0);aq.stroke();setTimeout(ad,0)},V=function(){ae%26%26ao.push({data:ae.getImageData(0,0,ax.width,ax.height),delay:ap})},ad,an=-1,S,am=!1,ab,F=!1,C=function(){if(F=ac){an=(an+1+ao.length)%25ao.length;S=an+1;aq.putImageData(ao[an].data,0,0);1==S%26%26null!=al%26%26(al.currentTime=0,al.play());var l=10*ao[an].delay;l||(l=100);setTimeout(C,l)}};ab=function(){F||setTimeout(C,0)};var af=function(){var l=function(w,y,v){w=document.createElement(w);y%26%26(w.className="gif-sound_"+y);for(var x in v){w[x]=v[x]}return w},u=l("div","simple_tools"),t=l("button","mute"),p=l("button","close"),o=function(){ar.style.visibility="visible";t.innerHTML=am?"%26#x266a;":"%26#x266a;%26#x20e0;";t.title=am?"mute":"un mute";p.innerHTML="%26#x00D7";p.title="Close sound-gif and go back to original image";ar.innerHTML="";u.innerHTML="";if(2>ao.length){if("xhr"==av){ar.appendChild(document.createTextNode("Load failed; cross-domain? "));var w=l("button","popup");w.addEventListener("click",function(){window.open(k.src)});w.innerHTML="%26nearr;";w.title="Click to open GIF in new window; try running gif-sound there instead";ar.appendChild(w)}else{"parse"==av%26%26ar.appendChild(document.createTextNode("Parse failed "))}ar.appendChild(p)}else{var w=function(x,y){x.innerHTML="";y.forEach(function(z){x.appendChild(z)})},v=[t,p];w(ar,[u]);w(u,v)}},s=function(){ac=!ac;o();ac?al.play():al.pause();ab()};t.addEventListener("click",function(){am=!am;al.volume=am?0:1;o()},!1);p.addEventListener("click",m,!1);at.addEventListener("click",s,!1);at.addEventListener("mouseout",function(){ac%26%26s()},!1);at.addEventListener("mouseover",function(){ac||s()},!1);ai.addEventListener("click",function(v){v.preventDefault()},!1);o()};ad=function(){setTimeout(af,0);av||(at.width=ax.width,at.height=ax.height,ab())};var m=function(){ac=!1;ak.insertBefore(k,ai);ak.removeChild(ai)},r=function(l){W("Decoding (frame "+(ao.length+1)+")...",aw.pos,aw.data.length,l)},q=function(){},X=function(l,o){return function(p){l(p);r(o)}},n={hdr:X(function(l){ax=l;at.width=ax.width;at.height=ax.height;ai.style.width=ax.width+"px";ar.style.minWidth=ax.width+"px";aa.width=ax.width;aa.height=ax.height}),gce:X(function(l){V();ap=au=null;ag=ah;ae=ah=null;au=l.transparencyGiven?l.transparencyIndex:null;ap=l.delayTime;ah=l.disposalMethod}),com:X(q),app:{RIFFWAVE:X(function(l){var o=l.data.length+4,l=[["RIFF",String.fromCharCode(o%26255,o>>8%26255,o>>16%26255,o>>24%26255),"WAVE"].join(""),l.data].join(""),l="data:audio/wav;base64,"+escape(window.btoa(l));al=new Audio;al.src=l}),NETSCAPE:X(q)},img:X(function(l){ae||(ae=aa.getContext("2d"));var p=l.lctFlag?l.lct:ax.gct,o=ae.getImageData(l.leftPos,l.topPos,l.width,l.height);l.pixels.forEach(function(s,t){if(au!==s){o.data[4*t+0]=p[s][0],o.data[4*t+1]=p[s][1],o.data[4*t+2]=p[s][2],o.data[4*t+3]=255}else{if(2===ag||3===ag){o.data[4*t+3]=0}}});ae.putImageData(o,l.leftPos,l.topPos);aq.putImageData(o,l.leftPos,l.topPos)},!0),eof:function(){V();r(!1);ar.innerHTML="Playing...";ad()}},ak=k.parentNode,ai=document.createElement("div"),at=document.createElement("canvas"),aq=at.getContext("2d"),ar=document.createElement("div"),aa=document.createElement("canvas");at.width=k.width;at.height=k.height;ar.style.minWidth=k.width+"px";ai.className="gif-sound";ar.className="gif-sound_toolbar";ai.appendChild(at);ai.appendChild(ar);ak.insertBefore(ai,k);ak.removeChild(k);ar.innerHTML="Loading...";var Z=new XMLHttpRequest;Z.overrideMimeType("text/plain; charset=x-user-defined");Z.onload=function(){aw=new c(Z.responseText);setTimeout(aj,0)};Z.onprogress=function(l){l.lengthComputable%26%26W("Loading...",l.loaded,l.total,!0)};Z.onerror=function(){Y("xhr")};Z.open("GET",k.src,!0);Z.send()},0);i.preventDefault()},f=function(i){var l=i.className.split(/\s/).filter(function(m){return"gif-sound_overlaid"!==m}),k=" ";void 0===k%26%26(k="");l=l.reduce(function(n,m){return n+k+m},"");i.className=l;i.removeEventListener("click",j,!1)},d=document.createElement("style");d.type="text/css";d.textContent=".gif-sound{display:inline;position:relative;padding-bottom:3px}.gif-sound_toolbar{visibility:hidden;overflow:visible;padding:3px;position:absolute;left:0;z-index:50}.gif-sound_toolbar button{width:2em;height:2em;text-align:center}.gif-sound_simple_tools{display:inline-block}.gif-sound_cur_frame{width:2em;color:black}.gif-sound_delay_info{width:2em;color:black}.gif-sound:hover .gif-sound_toolbar{visibility:visible}.gif-sound{text-decoration:none;color:black}.gif-sound_overlaid{border:5px solid red}.gif-sound_overlaid:hover{border:5px solid blue}";document.body.appendChild(d);b.forEach(function(i){-1===i.className.split(/\s/).indexOf("gif-sound_overlaid")%26%26(i.className+=" gif-sound_overlaid",i.addEventListener("click",j,!1))})};bookmarklet();'>test</a>


<div>
   <img src="img/result.gif">
</div>

 </body>
</html>
